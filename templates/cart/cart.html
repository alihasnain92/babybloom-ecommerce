{% extends 'base.html' %}
{% block title %}Your Cart â€” BabyBloom{% endblock %}
{% block content %}
<div class="container py-5">
  <div class="mb-4">
    <h2 class="fw-bold" style="font-family:'Playfair Display',serif;">&#x1F6D2; Shopping Cart</h2>
    <p class="text-muted">{{ cart_items|length }} item{% if cart_items|length != 1 %}s{% endif %} in your cart</p>
  </div>

  {% if cart_items %}
  <div class="row g-4">
    <!-- Items -->
    <div class="col-lg-8">
      {% for item in cart_items %}
      <div class="cart-item d-flex gap-3 align-items-center">
        {% if item.product.image %}
        <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
        {% else %}
        <div class="d-flex align-items-center justify-content-center bg-light rounded" style="width:90px;height:90px;font-size:2rem;flex-shrink:0;">&#x1F37C;</div>
        {% endif %}
        <div class="flex-grow-1">
          <p class="category-badge">{{ item.product.category.name }}</p>
          <h6 class="fw-bold mb-1">{{ item.product.name }}</h6>
          <p class="price-tag mb-0" style="font-size:1.1rem;">${{ item.product.price }}</p>
        </div>
        <div class="d-flex flex-column align-items-end gap-2">
          <form method="post" action="{% url 'update_cart' item_id=item.id %}" class="d-flex align-items-center gap-2">
            {% csrf_token %}
            <input type="number" name="quantity" value="{{ item.quantity }}" min="1" max="99"
              class="form-control text-center fw-bold" style="width:70px;border-radius:10px;border:2px solid #f0f0f0;padding:.4rem;">
            <button type="submit" class="btn btn-outline-primary btn-sm" style="border-radius:10px;"><i class="bi bi-check2"></i></button>
          </form>
          <form method="post" action="{% url 'remove_cart' item_id=item.id %}">
            {% csrf_token %}
            <button type="submit" class="btn btn-sm" style="color:#e91e8c;border:none;background:none;font-size:.82rem;"><i class="bi bi-trash me-1"></i>Remove</button>
          </form>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Summary -->
    <div class="col-lg-4">
      <div class="cart-summary">
        <h5 class="fw-bold mb-4">Order Summary</h5>
        {% for item in cart_items %}
        <div class="d-flex justify-content-between mb-2" style="font-size:.9rem;">
          <span class="text-muted">{{ item.product.name }} x{{ item.quantity }}</span>
          <span class="fw-semibold">${{ item.get_subtotal }}</span>
        </div>
        {% endfor %}
        <hr>
        <div class="d-flex justify-content-between mb-1">
          <span class="text-muted">Subtotal</span>
          <span class="fw-bold">${{ total }}</span>
        </div>
        <div class="d-flex justify-content-between mb-4">
          <span class="text-muted">Shipping</span>
          <span class="text-success fw-semibold">Free</span>
        </div>
        <div class="d-flex justify-content-between mb-4 pt-2 border-top">
          <span class="fw-bold fs-5">Total</span>
          <span class="fw-bold fs-5" style="color:#e91e8c;">${{ total }}</span>
        </div>
        <a href="{% url 'checkout' %}" class="btn btn-pink w-100 py-2 mb-3">
          <i class="bi bi-credit-card me-2"></i>Proceed to Checkout
        </a>
        <a href="{% url 'shop' %}" class="btn btn-outline-pink w-100 py-2" style="font-size:.9rem;">
          <i class="bi bi-arrow-left me-2"></i>Continue Shopping
        </a>
      </div>
    </div>
  </div>

  {% else %}
  <!-- Empty cart -->
  <div class="text-center py-5">
    <div style="font-size:5rem;margin-bottom:1rem;">&#x1F6D2;</div>
    <h4 class="fw-bold mb-2">Your cart is empty</h4>
    <p class="text-muted mb-4">Looks like you haven't added anything yet.</p>
    <a href="{% url 'shop' %}" class="btn btn-pink btn-lg px-5">Start Shopping</a>
  </div>
  {% endif %}
</div>
{% endblock %}
